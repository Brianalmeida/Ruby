#!/usr/bin/ruby

require 'csv'

#puts "What CVE would like to look for? "
#answer = gets.chomp

$total_cve = 22

def SEARCH_CVES

  cveDB = ""
  cveList = ""
  ghsa_search = []
  test_memory = []

  cve_hash = Array.new

  CSV.foreach("#{cveList}") do |listing|
    cve_hash << listing.to_s

    CSV.foreach("#{cveDB}", headers: 'image,package_name,vulnerability_id,severity') do |row|

      if $total_cve == listing.length
        if true
          listing.each do |iterate|
            test_memory << listing.grep(/^CVE-\d{4}-\d{4,}$/) in row
            if test_memory == listing
              break
              puts "Pausing..."
            elsif test_memory != listing
              break
              puts "Something is not right, stopping"
            end
          end

          ghsa_search << listing.max == "/^GHSA/"
          return test_memory, ghsa_search
        end
      elsif $total_cve != listing.length
        puts "Total of CVEs do not match!"
      end

    end
  end
end

  p SEARCH_CVES()
